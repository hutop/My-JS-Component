(function($){var now=+new Date;$.fn.extend({emptyTips:function(emptyText,emptyColor){return this.each(function(){if(this.type.toLowerCase()!=="text"&&this.type.toLowerCase()!=="textarea"){return true}var oriColor=this.style.color;oriColor=oriColor===""?"black":oriColor;this.isEmpty="true";$(this).bind({blur:function(){if(this.value===""||this.value===emptyText){this.value=emptyText;this.style.color=emptyColor;this.isEmpty="true"}else{this.style.color=oriColor;this.isEmpty="false"}},focus:function(){if(this.value===emptyText){this.value="";this.style.color=oriColor}}}).blur()})},popup:function(closeBtnID,needTray,needBG,trayColor,bgColor){return this.each(function(){var body=$("body"),doc=$(document),bg,evt,w,h,vpCenter,myBg,evtPos,i,closeBtns,closePopup;needTray=needTray===false?false:true;needBG=needBG===false?false:true;if(needBG){bgColor=!!bgColor?bgColor:"#000000";bg=$('<div style="position:absolute;top:0;left:0;width:'+body.width()+"px;height:"+doc.height()+"px;z-index:9998;opacity:0.5;filter:alpha(opacity=50);background-color:"+bgColor+';"><iframe style="width:100%;z-index: -1;height:100%;background:transparent;color:#fff;opacity:0;filter:alpha(opacity=0);" allowTransparent="true" frameBorder="0" src="Utils/blank.htm"></iframe></div>');bg.appendTo(body)}evt=$(this);evt.show();w=evt.outerWidth();h=evt.outerHeight();vpCenter=$.viewportCenter(w,h);evt.css({top:vpCenter.top+"px",left:vpCenter.left+"px",zIndex:10000,position:"absolute"});if(needTray){trayColor=!!trayColor?trayColor:"#2681f5";myBg=$('<div style="position:absolute;z-index:9999;background-color:'+trayColor+';opacity:0.5;filter:alpha(opacity=50);display:block;"></div>');evtPos=evt.offset();myBg.css({width:(w+12)+"px",height:(h+12)+"px",top:(evtPos.top-6)+"px",left:(evtPos.left-6)+"px"});myBg.appendTo(body)}closeBtns="";for(i=closeBtnID.length-1;i>=0;i--){closeBtns+="#"+closeBtnID[i]+","}if(closeBtns.length>0){closeBtns=closeBtns.slice(0,closeBtns.length-1);closePopup=function(){evt.css({display:"none"});if(needBG){bg.dropToDustbin()}if(needTray){myBg.dropToDustbin()}$(closeBtns).unbind("click",closePopup);$.collapsePopup=null;evt.trigger("popUpClose")};$(closeBtns).bind("click",closePopup);$.collapsePopup=closePopup}})},enterControlButton:function(ctrlID,ctrlEvent){return this.each(function(){var evt=$(this);evt.keydown(function(event){if(event.keyCode==13){eval('$("#'+ctrlID+'").'+ctrlEvent+"()")}})})},maxLength:function(l){var evt=$(this);evt.keydown(function(event){var val=this.value;if(val.length>=l&&!(event.keyCode==8||event.keyCode==9||(event.keyCode>=37&&event.keyCode<=40))){return false}})},maxValue:function(v){var evt=$(this);evt.keydown(function(e){var val=evt.val();try{if(parseFloat(val)>=v&&!(event.keyCode==8||event.keyCode==9||(event.keyCode>=37&&event.keyCode<=40))){return false}}catch(ex){throw ex}}).keyup(function(e){var val=this.value;if(parseFloat(val)>v){this.value=v}})},inputPositive:function(){return this.each(function(){var evt=$(this);evt.keydown(function(event){var keycode=event.keyCode;if(keycode===229){$(this).one("keyup",function(){this.value=this.value.replace(/[^\d\+\-\.]$/g,"")});return}if((keycode==190||keycode==110)&&this.value.indexOf(".")>-1){return false}if(!((keycode>47&&keycode<58)||(keycode>95&&keycode<106)||keycode==8||event.keyCode==9||keycode==110||keycode==190||(keycode>=37&&keycode<=40))){return false}})})},inputPositiveInt:function(){return this.each(function(){var evt=$(this);evt.keydown(function(event){var keycode=event.keyCode;if(keycode===229){$(this).one("keyup",function(){this.value=this.value.replace(/[^\d\+]$/g,"")});return}if(!((keycode>47&&keycode<58)||(keycode>95&&keycode<106)||keycode==8||event.keyCode==9||(keycode>=37&&keycode<=40))){return false}})})},inputInt:function(){return this.each(function(){var evt=$(this);evt.keydown(function(event){var keycode=event.keyCode;if(keycode===229){$(this).one("keyup",function(){this.value=this.value.replace(/[^\d\+\-]$/g,"")});return}if(!((keycode>47&&keycode<58)||(keycode>95&&keycode<106)||keycode==8||event.keyCode==9||keycode==107||keycode==109||keycode==187||keycode==189||(keycode>=37&&keycode<=40))){return false}if((keycode==107||keycode==109||keycode==187||keycode==189)&&this.value.indexOf("-")>-1){return false}})})},inputChar:function(){return this.each(function(){var evt=$(this);evt.keydown(function(event){var keycode=event.keyCode;if(keycode===229){$(this).one("keyup",function(){this.value=this.value.replace(/[^A-Za-z0-9]/g,"")});return}if(!((keycode>=65&&keycode<=90)||keycode==8||event.keyCode==9||(keycode>47&&keycode<58)||(keycode>95&&keycode<106))){return false}})})},inputDigit:function(){return this.each(function(){var evt=$(this);evt.keydown(function(event){var keycode=event.keyCode;if(keycode===229){$(this).one("keyup",function(){this.value=this.value.replace(/[^0-9]/g,"")});return}if(!(keycode==8||event.keyCode==9||(keycode>47&&keycode<58)||(keycode>95&&keycode<106))){return false}})})},tipsBox:function(opts){var def={tar:"",position:"top left",needClose:true,bgStyle:"white",zIndex:10000},evt=this;def=$.extend(true,{},def,opts);if(!def.tar||def.tar.length===0){return this}function location(){var tar,hasInit,evt,evtL,evtT,evtW,evtH,tarW,tarH,tarPos,tarT,tarL,arrow,arrowLine,arrDiv,btnClose=$('<a href="javascript:void(0);" class="btn-close"></a>');if(typeof def.tar==="string"){tar=$("#"+def.tar)}else{tar=$(def.tar)}evt=$(this).appendTo("body").show();tarW=tar.outerWidth();tarH=tar.outerHeight();tarPos=tar.offset();tarT=tarPos.top;tarL=tarPos.left;hasInit=evt.attr("tipsBox")==="true";if(hasInit){evt.find("div:first").dropToDustbin();evt.find("a.btn-close").dropToDustbin()}arrow=$("<span>◆</span>");arrowLine=$("<em>◆</em>");arrDiv=$("<div></div>");arrDiv.prepend(arrow).prepend(arrowLine);evt.addClass("tips-box").prepend(arrDiv);if(def.bgStyle==="white"){evt.addClass("tips-box-white")}if(def.needClose){btnClose.click(function(){evt.hide();return false});evt.prepend(btnClose).css({"padding-right":btnClose.outerWidth()+5})}evtW=evt.outerWidth();evtH=evt.outerHeight();switch(def.position){case"top left":arrow.addClass("arr-t");arrowLine.addClass("arr-line-t");arrDiv.addClass("top-box arr-pos-left");evtT=tarH+tarT;evtL=tarL;break;case"top right":arrow.addClass("arr-t");arrowLine.addClass("arr-line-t");arrDiv.addClass("top-box arr-pos-right");evtT=tarH+tarT;evtL=tarW+tarL-evtW;break;case"bottom left":arrow.addClass("arr-b");arrowLine.addClass("arr-line-b");arrDiv.addClass("bottom-box arr-pos-left");evtT=tarT-evtH;evtL=tarL;break;case"bottom right":arrow.addClass("arr-b");arrowLine.addClass("arr-line-b");arrDiv.addClass("bottom-box arr-pos-right");evtT=tarT-evtH;evtL=tarW+tarL-evtW;break;case"left top":arrow.addClass("arr-l");arrowLine.addClass("arr-line-l");arrDiv.addClass("left-box arr-pos-top");evtT=tarT-10;evtL=tarL+tarW+10;break;case"left bottom":arrow.addClass("arr-l");arrowLine.addClass("arr-line-l");arrDiv.addClass("left-box arr-pos-bottom");evtT=tarT-evtH-10;evtL=tarL+tarW+10;break;case"right top":arrow.addClass("arr-r");arrowLine.addClass("arr-line-r");arrDiv.addClass("right-box arr-pos-top");evtT=tarT-10;evtL=tarL-evtW-10;break;case"right bottom":arrow.addClass("arr-r");arrowLine.addClass("arr-line-r");arrDiv.addClass("right-box arr-pos-bottom");evtT=tarT-evtH-10;evtL=tarL-evtW-10;break;default:arrow.addClass("arr-t");arrowLine.addClass("arr-line-t");arrDiv.addClass("top-box arr-pos-left");evtT=tarH+tarT;evtL=tarL+10;break}evt.css({top:evtT,left:evtL,zIndex:def.zIndex}).attr("tipsBox","true");if($.isIE6&&evt.find("iframe[src='Utils/blank.htm']").length===0){evt.append("<iframe src='Utils/blank.htm' style='position:absolute;top:-1px;left:-1px;z-index:-1;width:"+evtW+"px;height:"+evtH+"px;opacity:0;filter:alpha(opacity=0);color:#fff;backkground:transparent' allowTransparent='true' frameBorder='0'></iframe>")}}return this.each(location)},maxHeight:function(h,s){return this.each(function(){var evt=$(this);if($.isIE6){if(!!s){evt.css($.extend({height:h},s))}else{evt.css({height:h,"overflow-y":"scroll"})}}else{if(!!s){evt.css($.extend({maxHeight:h},s))}else{evt.css({maxHeight:h,"overflow-y":"scroll"})}}})},mouseGestures:function(opts){var def={step:100,duration:"fast"},timeStamp,distance;def=$.extend(true,def,opts);function catchStart(e){timeStamp=+new Date;distance=e.pageX;$(this).trigger("moveStart")}function catchEnd(e){var evt=$(this),direction,step,evtW=evt.outerWidth(),evtL=evt.position().left;timeStamp=+new Date-timeStamp;distance=e.pageX-distance;direction=distance>0?1:-1;step=direction*def.step+evtL;step=step>0?0:step;step=step<-evtW+def.step?-evtW+def.step:step;if(timeStamp<500&&Math.abs(distance)>40){evt.animate({left:step},def.duration,function(){evt.trigger("moveComplete")})}}return this.each(function(){var evt=$(this);evt.mousedown(catchStart).mouseup(catchEnd)})},blinkBg:function(opts){var def={color:"#dc0c02",times:4,duration:100};def=$.extend(true,def,opts);if(def.times%2!==0){++def.times}if(def.duration<50){def.duration=50}function blink(elem,c){elem.css({"background-color":c})}return this.each(function(){var elem=$(this),oriColor,i,duration,color;oriColor=elem.css("background-color");for(i=0;i<def.times;i++){duration=def.duration*i;color=i%2===0?def.color:oriColor;(function(e,c,d){setTimeout(function(){blink(e,c)},d)})(elem,color,duration)}})},dropToDustbin:function(opts){return this.each(function(){$.event.remove(this);$.removeData(this);if(this.parentNode&&$(this).closest("#dvDustbin"+now).length<1){document.getElementById("dvDustbin"+now).appendChild(this)}})}});$(function(){$('<div id="dvDustbin'+now+'" style="display:none;"></div>').appendTo($("body"));function clearDustbin(){document.getElementById("dvDustbin"+now).innerHTML="";setTimeout(clearDustbin,5000)}clearDustbin();$(window).unload(function(){document.getElementById("dvDustbin"+now).innerHTML=""})});$.extend({errLog:[],queryString:function(name,val,href){var str,queryInit,qs,nameValList=[],temp,i;if(!!href){str=href}else{str=location.href}queryInit=str.indexOf("?")+1;qs=str.slice(queryInit).split("&");if(!val){for(i=qs.length-1;i>=0;i--){if(qs[i].indexOf("=")>-1){temp=qs[i].split("=");if(temp[0].toLowerCase()==name.toLowerCase()){return temp[1]}}}}else{val=val.toString();for(i=qs.length-1;i>=0;i--){if(qs[i].indexOf("=")>-1){temp=qs[i].split("=");if(temp[0]==name){break}}}if(i>=0){temp=qs[i].split("=");temp[1]=val;return str.replace(qs[i],temp[0]+"="+temp[1])}else{if(str.indexOf("?")<0){return str+"?"+temp[0]+"="+val}else{return str+"&"+name+"="+val}}}return""},_tipsBoxTpl:$('<div style="border:solid 1px #2681f5;padding:10px;position:absolute;background-color:#fff;z-index:99999;overflow:hidden;"></div>'),_tipsBoxIE6Fix:$('<div style="filter:alpha(opacity=0);opacity:0;position:absolute;z-index:99998;overflow:hidden;"><iframe src="Utils/blank.htm" frameBorder="0" style="z-index:-1;width:100%;height:100%;"></iframe>&nbsp;</div>'),_tipsBoxIE6Fix2:$('<div style="filter:alpha(opacity=0);opacity:0;position:absolute;z-index:999;overflow:hidden;"><iframe src="Utils/blank.htm" frameBorder="0" style="z-index:-1;width:100%;height:100%;"></iframe>&nbsp;</div>'),tipsBox:function(tips,fadeIn,duration,fadeOut,callback,blink){fadeIn=!!fadeIn?fadeIn:600;duration=!!duration?duration:2500;fadeOut=!!fadeOut?fadeOut:1000;var pos=$.viewportCenter(200,80);$._tipsBoxTpl.css({top:pos.top,left:pos.left,display:"none"}).html(tips).appendTo($("body"));var w=$._tipsBoxTpl.outerWidth();var h=$._tipsBoxTpl.outerHeight();$._tipsBoxIE6Fix.css({top:pos.top,left:pos.left,width:w,height:h}).appendTo($("body"));$._tipsBoxTpl.stop().css({opacity:"1",width:180}).fadeIn(fadeIn,function(){setTimeout(function(){$._tipsBoxTpl.fadeOut(fadeOut,function(){$._tipsBoxTpl.remove();$._tipsBoxIE6Fix.remove();if(!!callback){callback()}})},duration)});if(!!blink){$._tipsBoxTpl.blinkBg({color:"#ffd0d0",times:6})}},_tipsBoxTplArr:$("<div></div>"),tipsBoxArr:function(opts){var def={tar:null,position:"top left",needClose:true,bgStyle:"white",tips:""};if(!!opts.tar){def=$.extend(true,def,opts);if(typeof def.tips==="string"){$._tipsBoxTplArr.html(opts.tips).removeAttr("tipsBox").tipsBox(def)}else{$._tipsBoxTplArr.append(opts.tips).removeAttr("tipsBox").tipsBox(def)}}},tipsBoxArrClose:function(){$._tipsBoxTplArr.hide()},viewportCenter:function(w,h){var win=$(window);var vpWidth=win.width();var vpHeight=win.height();var vpScrollTop=win.scrollTop();var vpScrollLeft=win.scrollLeft();return{left:(vpWidth-w)/2+vpScrollLeft,top:(vpHeight-h)/2+vpScrollTop,winCenter:{top:vpHeight/2,left:vpWidth/2}}},isDigit:function(s){var digit=/^\d*$/g;return digit.test(s)},isInt:function(s){var i=/^(?:(?:\+|\-)?[1-9]\d*|0)$/g;return i.test(s)},isPositiveInt:function(s){var i=/^(?:\+?[1-9]\d*|0)$/;return i.test(s)},isPositive:function(s){var positiveNum=/^(?:\+?[1-9]\d*(?:\.\d+)?|0(?:\.\d+)?)$/g;return positiveNum.test(s)},isDate:function(s){var date=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/;return date.test(s)},isChar:function(s){var str=/[a-zA-Z0-9]+/g;return str.test(s)},checkMoney:function(s){var tempValue=s.replace(/(^\s+)|(\s+$)/g,"");if(!tempValue){return false}if(/^-?\d+(\.\d+)?$/.test(tempValue)){return true}},bindMaxLength:function(){$("input:text").each(function(){var evt=$(this);if(!!evt.attr("MaxLength")){evt.keydown(function(event){var val=evt.val();if(val.length>=l&&event.keyCode!=8){return false}})}})},collapsePopup:null,toJsonString:function(obj){var tmp="{",i;for(i in obj){if(obj.hasOwnProperty(tmp)){tmp+='"'+i+'":"'+obj[i]+'",'}}return tmp.slice(0,-1)+"}"},mousePos:function(e){var b=document.body;if(!e.pageX){return{x:e.clientX+b.scrollLeft-b.clientLeft,y:e.clientY+b.scrollTop-b.clientTop}}else{return{x:e.pageX,y:e.pageY}}},isIE6:$.browser.msie&&parseFloat($.browser.version)<7});$.MTHCrmButton=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.button=null;this.initButton();return this};$.extend(true,$.MTHCrmButton.prototype,{initButton:function(){this.enable()},defaultOptions:{outCls:"btn-out",overCls:"btn-over",clickCls:"btn-click",btnTitle:"",btn_disabled_cls:"btn-disabled",btn_cls:"btn",imgSrc:"",imgSrc_disabled:"",callback:{},btnTpl:'<table cellspacing="0" cellpadding="0" class="{2}"><tr><td class="btn-left">&nbsp;</td><td class="btn-center"><img alt="{0}" title="{0}" src="{1}" /></td><td class="btn-right">&nbsp;</td></tr></table>'},setOptions:function(opts){this.options=$.extend(true,this.options,opts)},appendTo:function(tar){this.button.appendTo(tar);return this},bindEvents:function(evts){this.button.bind(evts);return this},unbindEvents:function(evtName,func){if(evtName===""){this.button.unbind()}else{if(!!func){this.button.unbind(evtName,func)}else{this.button.unbind(evtName)}}return this},enable:function(){var self=this;var tmpBtn;tmpBtn=$(this.options.btnTpl.replace(/\{0\}/mg,this.options.btnTitle).replace(/\{1\}/mg,this.options.imgSrc).replace(/\{2\}/mg,this.options.btn_cls));tmpBtn.hover(function(){$(this).removeClass(self.options.outCls+" "+self.options.clickCls).addClass(self.options.overCls)},function(){$(this).removeClass(self.options.overCls+" "+self.options.clickCls).addClass(self.options.outCls)});tmpBtn.mousedown(function(){$(this).removeClass(self.options.outCls+" "+self.options.overCls).addClass(self.options.clickCls)});tmpBtn.click(function(){$(this).removeClass(self.options.clickCls+" "+self.options.outCls).addClass(self.options.overCls)});tmpBtn.bind(this.options.callback);if(!!this.button){this.button.replaceWith(tmpBtn)}this.button=tmpBtn;return this},disable:function(){this.button.unbind();var tmpBtn=$(this.options.btnTpl.replace(/\{0\}/mg,this.options.btnTitle).replace(/\{1\}/mg,this.options.imgSrc_disabled).replace(/\{2\}/mg,this.options.btn_disabled_cls));this.button.replaceWith(tmpBtn);this.button=tmpBtn;return this},dispose:function(){this.button.dropToDustbin()},css:function(name,extra){return this.button.css(name,extra)}});$.MTHCrmPagingBar=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.pagingBar=null;this.btnFirPage=null;this.btnPrevPage=null;this.btnNextPage=null;this.btnLastPage=null;this.btnRefresh=null;this.quickPaging=null;this.pageIndex=1;this.pageCount=1;this.totalCount=1;this.pageSize=10;this.initPagingBar();return this};$.extend(true,$.MTHCrmPagingBar.prototype,{initPagingBar:function(){var self=this;this.pagingBar=$(this.options.pagingBarTpl);this.btnFirPage=new $.MTHCrmButton({btnTitle:"第一页",imgSrc:this.options.btnsSrc.first,imgSrc_disabled:this.options.btnsSrc_disabled.first,callback:this.options.btnsFunc.first});this.btnFirPage.appendTo(this.pagingBar).disable();this.btnPrevPage=new $.MTHCrmButton({btnTitle:"上一页",imgSrc:this.options.btnsSrc.prev,imgSrc_disabled:this.options.btnsSrc_disabled.prev,callback:this.options.btnsFunc.prev});this.btnPrevPage.appendTo(this.pagingBar).disable();this.btnNextPage=new $.MTHCrmButton({btnTitle:"下一页",imgSrc:this.options.btnsSrc.next,imgSrc_disabled:this.options.btnsSrc_disabled.next,callback:this.options.btnsFunc.next});this.btnNextPage.appendTo(this.pagingBar).bindEvents({click:function(){self.paging(self.pageIndex+1)}});this.btnLastPage=new $.MTHCrmButton({btnTitle:"最后一页",imgSrc:this.options.btnsSrc.last,imgSrc_disabled:this.options.btnsSrc_disabled.last,callback:this.options.btnsFunc.last});this.btnLastPage.appendTo(this.pagingBar).bindEvents({click:function(){self.paging(self.pageCount)}});this.btnRefresh=new $.MTHCrmButton({btnTitle:"刷新",imgSrc:this.options.btnsSrc.refresh,imgSrc_disabled:this.options.btnsSrc_disabled.refresh,callback:this.options.btnsFunc.refresh});this.btnRefresh.appendTo(this.pagingBar).bindEvents({click:function(){self.paging(self.pageIndex)}});this.quickPaging=$('<table cellpadding="0" cellspacing="0" class="btn"><tr><td>共<span>'+this.totalCount+"</span>条/<span>"+this.pageCount+'</span>页,当前第</td><td><input type="text" value="'+this.pageIndex+'" style="width:50px;border:1px solid #98c0f4" /></td><td><span>页</span>(每页<span>'+this.pageSize+"</span>条)</td></tr></table>");this.quickPaging.appendTo(this.pagingBar);this.quickPaging.find("input:text").keydown(function(event){var keycode=event.keyCode,index;if(keycode==13){index=parseInt(this.value);self.paging(index);event.stopPropagation();return false}}).inputInt()},defaultOptions:{pagingBarTpl:'<div class="toolbar"></div>',btnsSrc:{first:"",prev:"",next:"",last:"",refresh:""},btnsSrc_disabled:{first:"",prev:"",next:"",last:"",refresh:""},btnsFunc:{first:{},prev:{},next:{},last:{},refresh:{}},sendPagingReq:$.noop},enable:function(){var self=this;this.btnFirPage.enable().bindEvents({click:function(){self.paging(1)}});this.btnLastPage.enable().bindEvents({click:function(){self.paging(self.pageCount)}});this.btnNextPage.enable().bindEvents({click:function(){self.paging(self.pageIndex+1)}});this.btnPrevPage.enable().bindEvents({click:function(){self.paging(self.pageIndex-1)}});this.btnRefresh.enable().bindEvents({click:function(){self.paging(self.pageIndex)}})},disable:function(){this.btnFirPage.disable();this.btnLastPage.disable();this.btnNextPage.disable();this.btnPrevPage.disable();this.btnRefresh.disable()},setOptions:function(opts){this.options=$.extend(true,this.options,opts)},setQuickPagingValue:function(pageCount,pageIndex,totalCount,pageSize){this.quickPaging.find("span:first").html(totalCount);this.quickPaging.find("span:eq(1)").html(pageCount);this.quickPaging.find("span:last").html(pageSize);this.pageCount=pageCount;if(!!pageIndex){this.quickPaging.find("input:text").val(pageIndex);this.pageIndex=pageIndex}this.resetButtons(pageIndex);var self=this;this.btnRefresh.enable().bindEvents({click:function(){self.paging(self.pageIndex)}})},resetButtons:function(index){if(this.pageCount<=1||isNaN(this.pageCount)){this.btnFirPage.disable();this.btnPrevPage.disable();this.btnLastPage.disable();this.btnNextPage.disable();return}var self=this;this.quickPaging.find("input:text").val(index);this.pageIndex=index;switch(index){case 1:this.btnFirPage.disable();this.btnPrevPage.disable();this.btnLastPage.enable().bindEvents({click:function(){self.paging(self.pageCount)}});this.btnNextPage.enable().bindEvents({click:function(){self.paging(self.pageIndex+1)}});break;case this.pageCount:this.btnFirPage.enable().bindEvents({click:function(){self.paging(1)}});this.btnPrevPage.enable().bindEvents({click:function(){self.paging(self.pageIndex-1)}});this.btnLastPage.disable();this.btnNextPage.disable();break;default:this.enable();break}},paging:function(index){if(this.pageIndex==index){this.options.sendPagingReq(index,"refresh");return}index=(index>this.pageCount?this.pageCount:index);index=(index<0?0:index);this.resetButtons(index);this.options.sendPagingReq(index)},appendTo:function(tar){return this.pagingBar.appendTo(tar)},css:function(name,extra){if(!!extra){return this.pagingBar.css(name,extra)}else{return this.pagingBar.css(name)}},width:function(val){if(!!val){return this.pagingBar.width(val)}else{var adjust=parseInt(this.pagingBar.css("padding-left"))+parseInt(this.pagingBar.css("padding-right"))+parseInt(this.pagingBar.css("margin-left"))+parseInt(this.pagingBar.css("margin-right"))+parseInt(this.pagingBar.css("border-left-width"))+parseInt(this.pagingBar.css("border-right-width"));adjust=adjust==NaN?0:adjust;return this.pagingBar.width()+adjust}},height:function(val){if(!!val){return this.pagingBar.height(val)}else{var adjust=parseInt(this.pagingBar.css("padding-top"))+parseInt(this.pagingBar.css("padding-bottom"))+parseInt(this.pagingBar.css("margin-top"))+parseInt(this.pagingBar.css("margin-bottom"))+parseInt(this.pagingBar.css("border-top-width"))+parseInt(this.pagingBar.css("border-bottom-width"));adjust=isNaN(adjust)?0:adjust;return this.pagingBar.outerHeight()+adjust}},dispose:function(){var prop;this.pagingBar.dropToDustbin();for(prop in this){if(this.hasOwnProperty(prop)){if(!!this[prop]&&!!this[prop].dispose){this[prop].dispose()}this[prop]=null;delete this[prop]}}}});$.MTHCrmShadow=$.fn.MTHCrmShadow=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.shadow=null;this.initShadow();this.tar=null;return this};$.extend(true,$.MTHCrmShadow.prototype,{initShadow:function(){this.shadow=$(this.options.shadowTpl);this.options.tar=$(this.options.tar);this.resize()},resize:function(){var w,h,z,pos;w=this.options.tar.width();h=this.options.tar.height();z=this.options.tar.css("z-index");pos=this.options.tar.position();this.shadow.css({width:(w+12)+"px",height:(h+6)+"px",zIndex:this.shadow.css("z-index")||this.options.tar.css("z-index")-1,top:(pos.top)+"px",left:(pos.left-5)+"px"});this.shadow.children(":eq(1)").children().css({height:(h-6)+"px"});this.shadow.children().children(":nth-child(2)").css({width:w+"px"})},defaultOptions:{tar:null,shadowTpl:'<div class="shadow"><div class="st"><div class="stl"></div><div class="stc"></div><div class="str"></div></div><div class="sc"><div class="sml"></div><div class="smc"></div><div class="smr"></div></div><div class="sb"><div class="sbl"></div><div class="sbc"></div><div class="sbr"></div></div></div>'},setOptions:function(opts){this.options=$.extend(true,this.options,opts);return this},appendTo:function(tar){this.shadow.appendTo(tar);var ie55=(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 5.5")!=-1);var ie6=(navigator.appName=="Microsoft Internet Explorer"&&parseInt(navigator.appVersion)==4&&navigator.appVersion.indexOf("MSIE 6.0")!=-1);if(ie55||ie6){this.shadow.get(0).style.filter="progid:DXImageTransform.Microsoft.alpha(opacity=50) progid:DXImageTransform.Microsoft.Blur(pixelradius=4)"}return this},show:function(){this.shadow.show();return this},hide:function(){this.shadow.hide();return this},css:function(name,extra){return this.shadow.css(name,extra)}});$.MTHCrmComboBox=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.mainBody=null;this.items=[];this.pagingBar=null;this.itemsShell=null;this.shadow=null;this.loadingImg=null;this.focalItem=null;this.isShown=false;return this};$.extend(true,$.MTHCrmComboBox.prototype,{defaultOptions:{mainBodyTpl:'<div class="combox-cnt"></div>',header:"",itemsShellTpl:'<div style="overflow-x:hidden;overflow-y:scroll;position:relative;"></div>',itemTpl:"",itemIns:true,itemOutCls:"combox-item-normal",itemOverCls:"combox-item-selected",itemSelectedCls:"combox-item-selected",paging:true,pagingBarDelay:false,shadowing:true,pageSize:10,pageIndexField:"",pageCountField:"",totalCountField:"",textField:"",valueField:"",fields:["address","type"],btnsSrc_disabled:null,btnsSrc:null,dataSource:{},dataRoot:"root",width:300,complete:$.noop,maxHeight:0,minHeight:0,maxWidth:0,minWidth:0,allowScroll:false,ctrlID:"",itemCallback:{},emptyText:"请输入楼盘中文名或拼音字母....",emptyColor:"gray",loadingText:"请稍候...",loadingSrc:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/loading.gif",needLoading:true,pagingCallback:{},pagingBtnsSrc:{first:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-first.gif",prev:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-prev.gif",next:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-next.gif",last:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-last.gif",refresh:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/refresh.gif"},pagingBtnsSrc_disabled:{first:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-first-disabled.gif",prev:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-prev-disabled.gif",next:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-next-disabled.gif",last:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/page-last-disabled.gif",refresh:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/refresh.gif"},selected:function(itemData){},requestDelay:500,minChar:1,callback:null,keyboardNavi:false,synData:true,needCombine:true},className:"[object MTHCRMComboBox]",init:function(){var self=this,timeoutID,ready=false,ctrler=$("#"+this.options.ctrlID);ctrler.css({border:"1px solid"});ctrler.attr("isEmpty","true");ctrler.emptyTips(self.options.emptyText,self.options.emptyColor).keyup(function(event){var keyCode=event.keyCode;if(keyCode>=37&&keyCode<=40){return}if(keyCode==13){self.trigger("enterPress",null,self);ctrler.trigger("doSubmit");event.stopPropagation();return}if(!!timeoutID){clearTimeout(timeoutID)}var query=$(this).val();if(query.length<self.options.minChar){return}if(query!==self.options.emptyText&&query!==""){self.query=query}timeoutID=setTimeout(function(){self.getData()},self.options.requestDelay)}).attr("autocomplete","off");ctrler.blur();this.mainBody=$(this.options.mainBodyTpl);this.adjustPos();this.mainBody.keyup(function(event){if(event.keyCode==13){if(!!self.focalItem){if(self.options.itemIns){ctrler.val(self.focalItem.item.data("itemData")[self.options.textField])}else{ctrler.val(self.focalItem.data("itemData")[self.options.textField])}}self.trigger("enterPress",null,self);event.stopPropagation();return false}}).mouseover(function(){}).click(function(event){}).bind(this.options.callback);if(this.options.keyboardNavi){this.keyboardNavi()}return this},setOptions:function(opts){this.options=$.extend(true,this.options,opts)},getData:function(index,act){if(this.options.paging&&!this.options.pagingBarDelay){if(!!this.pagingBar){this.pagingBar.disable()}}if(this.options.ctrlID!==""){var canSend=$("#"+this.options.ctrlID).val();if(canSend==this.options.emptyText||canSend==""){return}}this.show();var self=this;var queryData={query:this.query,start:0,limit:this.options.pageSize};if(!!index){index-=1;queryData.start=index*10}else{if(index===null&&act==="refresh"&&this.options.paging){queryData.start=(this.pagingBar.pageIndex-1)*10;index=this.pagingBar.pageIndex-1}}if(this.options.needLoading){this.loading()}setTimeout(function(){self.trigger("startGetData")},50);this.options.dataSource.request(queryData,function(){if(self.options.synData||self.isShown){self.showData.call(self,index)}if(!!self.options.complete){self.options.complete.call(self)}self.trigger("complete");if(act!=="refresh"){self.trigger("pageChange")}},act);if(this.options.synData||this.isShown){this.resize()}if(this.options.shadowing){this.shadow.resize()}return this},showData:function(index){if(this.options.needLoading){this.loadingImg.remove()}this.initItems(index);if(this.options.paging&&!this.options.pagingBarDelay){var totalCount=this.options.dataSource.remoteData[this.options.totalCountField];var pageCount=Math.ceil(totalCount/this.options.pageSize);this.pagingBar.setQuickPagingValue(pageCount,!index||typeof index!=="number"?1:(index+1),totalCount,this.options.pageSize)}this.resize();if(this.options.shadowing){this.shadow.resize()}this.isShown=true;return this},appendTo:function(tar){this.renderComponent();this.mainBody.appendTo(tar);this.hide();return this},html:function(){},resize:function(){this.mainBody.height("auto");this.itemsShell.height("auto");var tbH=0;if(this.options.paging&&!this.options.pagingBarDelay){tbH=this.pagingBar.height()}var cbH=this.mainBody.height();cbH+=tbH;if(this.options.maxHeight>0){cbH=cbH>this.options.maxHeight?this.options.maxHeight:cbH}if(this.options.minHeight>0){cbH=cbH<this.options.minHeight?this.options.minHeight:cbH}if(this.options.allowScroll){this.itemsShell.height(cbH-tbH-3)}else{this.itemsShell.height(cbH-tbH);this.itemsShell.css({overflowY:"hidden"})}this.mainBody.height(cbH)},adjustPos:function(){var ctrler=$("#"+this.options.ctrlID),pos=ctrler.offset(),adjustW=parseInt(ctrler.css("border-left-width"))+parseInt(ctrler.css("border-right-width")),adjustH=parseInt(ctrler.css("border-top-width"))+parseInt(ctrler.css("border-bottom-width")),zIndex=ctrler.css("z-index"),parentZindex=ctrler;while(zIndex==="auto"&&!parentZindex.is($("body"))){parentZindex=parentZindex.parent();zIndex=parentZindex.css("z-index")}this.options.width=ctrler.width()+(adjustW==NaN?0:adjustW);if(this.options.maxWidth>0){this.options.width=this.options.width>this.options.maxWidth?this.options.maxWidth:this.options.width}if(this.options.minWidth>0){this.options.width=this.options.width<this.options.minWidth?this.options.minWidth:this.options.width}this.mainBody.css({top:(pos.top+ctrler.height()+(adjustH==NaN?0:adjustH))+"px",left:pos.left+"px",width:this.options.width+"px",zIndex:zIndex+1});if(this.shadowing){this.shadow.css({zIndex:zIndex})}},trigger:function(evt,handler,params){var paramArr;if(!handler){paramArr=[this];if(!!params){$.merge(paramArr,params)}this.mainBody.trigger(evt,paramArr)}else{this.mainBody.bind(evt,handler)}return this},inputTrigger:function(evt,handler,params){var paramArr;if(!handler){paramArr=[this];if(!!params){$.merge(paramArr,params)}$("#"+this.options.ctrlID).trigger(evt,paramArr)}else{$("#"+this.options.ctrlID).bind(evt,handler)}return this},delegate:function(selector,evt,handler,params){this.mainBody.delegate(selector,evt,handler);return this},undelegate:function(selector,evt){this.mainBody.undelegate(selector,evt);return this},renderComponent:function(){var self=this;this.itemsShell=$(this.options.itemsShellTpl);this.itemsShell.appendTo(this.mainBody);if(this.options.paging&&!this.options.pagingBarDelay){this.initPagingBar()}if($.isIE6){this.mainBody.append("<iframe src='Utils/blank.htm' style='position:absolute;top:-3px;left:-3px;z-index:-1;width:100%;height:100%;opacity:0;filter:alpha(opacity=0);color:#fff;backkground:transparent' allowTransparent='true' frameBorder='0'></iframe>")}if(this.options.shadowing){this.shadow=new $.MTHCrmShadow({tar:this.mainBody});this.shadow.appendTo($("body"))}this.hide()},initPagingBar:function(){var self=this;this.pagingBar=new $.MTHCrmPagingBar({callback:this.options.pagingCallback,sendPagingReq:function(index,act){self.getData(index,act)},btnsSrc_disabled:this.options.pagingBtnsSrc_disabled,btnsSrc:this.options.pagingBtnsSrc});this.pagingBar.appendTo(this.mainBody).click(function(e){self.trigger("pagingBarClick");e.stopPropagation()}).keyup(function(e){self.trigger("pagingBarEnterPress");e.stopPropagation()});this.options.pagingBarDelay=false;var totalCount=this.options.dataSource.remoteData[this.options.totalCountField];var pageCount=Math.ceil(totalCount/this.options.pageSize);this.pagingBar.setQuickPagingValue(pageCount,1,totalCount,this.options.pageSize)},loading:function(){this.disposeItems();if(this.loadingImg==null){this.loadingImg=$("<img />");if(parseFloat($.fn.jquery.slice(0,3))<1.6){this.loadingImg.attr({src:this.options.loadingSrc,alt:this.options.loadingText,title:this.options.loadingText})}else{this.loadingImg.prop({src:this.options.loadingSrc,alt:this.options.loadingText,title:this.options.loadingText})}}this.loadingImg.appendTo(this.itemsShell)},setFocalItem:function(item){this.focalItem=item},initItems:function(){var self=this;this.items=[];var tmpItem;if(this.options.dataSource.remoteData.success===undefined){return}if(!this.options.dataSource.remoteData.success){tmpItem=new $.MTHCrmComboBox.Item({fields:this.options.fields,callback:this.options.itemCallback,itemData:"error",displayTpl:"<div>"+this.options.dataSource.remoteData.errorText+"</div>",selected:$.noop});tmpItem.appendTo(this.itemsShell);this.items.push(tmpItem);return}if(!!this.options.dataSource.remoteData[this.options.dataRoot]&&!!this.options.dataSource.remoteData[this.options.dataRoot][0].empty){tmpItem=new $.MTHCrmComboBox.Item({fields:this.options.fields,callback:this.options.itemCallback,itemData:"empty",displayTpl:"<div>"+this.options.dataSource.remoteData[this.options.dataRoot][0].empty+"</div>",selected:$.noop});tmpItem.appendTo(this.itemsShell);this.items.push(tmpItem);return}if(this.options.itemIns){this.itemInstance()}else{this.itemText()}if(this.options.header.length>0){this.itemsShell.prepend(this.options.header)}},itemInstance:function(){var loopTimes=this.options.dataSource.remoteData[this.options.dataRoot].length-1;var self=this;for(var i=0;i<=loopTimes;i++){tmpItem=new $.MTHCrmComboBox.Item({fields:this.options.fields,callback:this.options.itemCallback,itemData:this.options.dataSource.remoteData[this.options.dataRoot][i],outCls:this.options.itemOutCls,overCls:this.options.itemOverCls,selectedCls:this.options.selectedCls,displayTpl:this.options.itemTpl,textField:this.options.textField,valueField:this.options.valueField,ctrlID:this.options.ctrlID,selected:this.options.selected,itemFocus:function(item){self.focalItem=item}},i);tmpItem.appendTo(this.itemsShell);this.items.push(tmpItem)}},itemText:function(){var self=this,itemsHtml=new StringBuilder();if(this.options.needCombine){var loopTimes=this.options.dataSource.remoteData[this.options.dataRoot].length-1,i=0,regFields=[];for(i=this.options.fields.length-1;i>=0;i--){regFields[i]=new RegExp("{"+this.options.fields[i]+"}","g")}var tmpHtml="";var remoteData;for(i=0;i<=loopTimes;i++){tmpHtml=this.options.itemTpl;remoteData=this.options.dataSource.remoteData[this.options.dataRoot][i];for(var j=regFields.length-1;j>=0;j--){tmpHtml=tmpHtml.replace(regFields[j],function(patt){return remoteData[patt.replace(/\{/g,"").replace(/\}/g,"")].replace(/\(/g,"（").replace(/\)/g,"）")})}tmpHtml=tmpHtml.replace(this.expr_if,function(patt,$1,$2,$3,$4){if($1==$2){return $3}else{return $4}}).replace(this.expr_odd_even,function(patt,$1,$2,$3){if($1=="odd"&&(i+1)%2!=0){return $3}if($2=="even"&&(i+1)%2==0){return $3}return""}).replace(this.expr_index,function(patt){return i+1}).replace(this.expr_switch,function(patt,$1,$2,$3){var rlt=$2.replace(self.expr_case,function(patt2,$4,$5){if($1===$4){return $5}return""});if(rlt===""&&!!$3){rlt=$3}return rlt});itemsHtml.append(tmpHtml)}}else{itemsHtml.append(this.options.dataSource.remoteData[this.options.dataRoot][0])}this.itemsShell.html(itemsHtml.toString());setTimeout(function(){self.bindEvents()},50);this.focalItem=null},bindEvents:function(){var items,itemTagName,oriCssText,self,itemCallback;this.itemsShell.undelegate();items=this.itemsShell.children();itemTagName=items.get(0).tagName;oriCssText=items.get(0).style.cssText;self=this;for(i=items.length-1;i>=0;i--){try{$(items[i]).data("itemData",this.options.dataSource.remoteData[this.options.dataRoot][i]);if((typeof this.options.itemOverCls).toLowerCase()==="object"){$.extend(items[i].style,this.options.itemOutCls)}else{$(items[i]).addClass(self.options.itemOutCls)}}catch(ex){$.errLog.push(ex.message);continue}}this.items=items;this.itemsShell.delegate(itemTagName,"mouseenter",function(){var elem=$(this),cssList,cssKeyValue,i,l;if(self.itemsShell.is(elem.parent())){if((typeof self.options.itemOverCls).toLowerCase()==="object"){$.extend(this.style,self.options.itemOverCls)}else{elem.removeClass(self.options.itemOutCls).addClass(self.options.itemOverCls)}self.focalItem=elem}}).delegate(itemTagName,"mouseleave",function(){var elem=$(this),cssList,cssKeyValue,i,l;if(self.itemsShell.is(elem.parent())){if((typeof self.options.itemOutCls).toLowerCase()==="object"){$.extend(this.style,self.options.itemOutCls)}else{if(self.options.itemOutCls===""){this.style.cssText=oriCssText}else{elem.removeClass(self.options.itemOverCls).addClass(self.options.itemOutCls)}}}}).delegate(itemTagName,"click",function(){var elem=$(this);if(self.itemsShell.is(elem.parent())){if(self.options.ctrlID!==""){$("#"+self.options.ctrlID).val(elem.data("itemData")[self.options.textField])}self.trigger("selectChange",null,[elem.data("itemData")]);self.options.selected.call(self,elem.data("itemData"))}});itemCallback=this.options.itemCallback;for(i in itemCallback){if(itemCallback.hasOwnProperty(i)){this.itemsShell.delegate(itemTagName,i,itemCallback[i])}}},expr_if:/\[if\(([^\)]*)\)=\(([^\)]*)\)\(([^\)]*)\)\:\(([^\)]*)\)\]/g,expr_odd_even:/(?:\[(odd)|\[(even))\:\(([^\)]*)\)\]/g,expr_index:/\[index\]/g,expr_switch:/\[switch\(([^\)]*)\)((?:case\([^\)*]\)\([^\)]*\))+)(?:default\(([^\)]*)\))?\]/g,expr_case:/case\(([^\)*])\)\(([^\)]*)\)/g,keyboardNavi:function(){var self=this;$("#"+self.options.ctrlID).keydown(function(event){if(self.mainBody.is(":visible")){var pos,h1,h2,st;var keyCode=event.keyCode;if(keyCode==38){if(!!self.focalItem.prev().data("itemData")){self.focalItem=self.focalItem.removeClass(self.options.itemOverCls).addClass(self.options.itemOutCls).prev().removeClass(self.options.itemOutCls).addClass(self.options.itemOverCls);pos=self.focalItem.position();h1=self.focalItem.outerHeight(true);st=self.itemsShell.scrollTop();if(pos.top<0){self.itemsShell.scrollTop(st-h1)}$(this).val(self.focalItem.data("itemData")[self.options.textField])}}else{if(keyCode==40){if(!!self.focalItem){if(!!self.focalItem.next().data("itemData")){self.focalItem=self.focalItem.removeClass(self.options.itemOverCls).addClass(self.options.itemOutCls).next().removeClass(self.options.itemOutCls).addClass(self.options.itemOverCls);pos=self.focalItem.position();h1=self.focalItem.outerHeight(true);st=self.itemsShell.scrollTop();h2=self.itemsShell.outerHeight();if(pos.top>(h2-h1)){self.itemsShell.scrollTop(st+h1)}$(this).val(self.focalItem.data("itemData")[self.options.textField])}}else{self.focalItem=$(self.items[0]).removeClass(self.options.itemOutCls).addClass(self.options.itemOverCls);pos=self.focalItem.position();h1=self.focalItem.outerHeight(true);st=self.itemsShell.scrollTop();h2=self.itemsShell.outerHeight();if(pos.top>(h2-h1)){self.itemsShell.scrollTop(st+h1)}$(this).val(self.focalItem.data("itemData")[self.options.textField])}}}}})},disposeItems:function(){if(this.options.itemIns){for(var i=this.items.length-1;i>=0;i--){this.items[i].dispose()}}else{if(this.items.length>0){$(this.items).dropToDustbin();this.itemsShell.undelegate()}}this.items=[]},setDataSource:function(source){this.options.dataSource=source;this.dataChage()},show:function(){if(this.mainBody.attr("hideOrShow")!=="show"){if(this.options.ctrlID!=""){this.adjustPos()}this.mainBody.show().attr("hideOrShow","show");if(this.options.shadowing){this.shadow.show()}this.trigger("show")}return this},hide:function(){if(this.mainBody.attr("hideOrShow")!=="hide"){this.mainBody.hide().attr("hideOrShow","hide");if(this.options.shadowing){this.shadow.hide()}this.trigger("hide")}var self=this;function bchf(){self.hide()}$("body").one("click",bchf);return this},css:function(name,extra){if(!!extra){return this.mainBody.css(name,extra)}else{return this.mainBody.css(name)}},toString:function(){return"[Object MTHCrmComboBox]"},dispose:function(){var prop;this.mainBody.dropToDustbin();this.disposeItems();if(!!this.options.ctrlID){$("#"+this.options.ctrlID).unbind()}this.trigger("dispose");for(prop in this){if(this.hasOwnProperty(prop)){if(!!this[prop]&&!!this[prop].dispose){this[prop].dispose()}this[prop]=null;delete this[prop]}}},clear:function(){this.options.dataSource.clearData();return this}});$.MTHCrmComboBox.Item=function(opts,index){this.options=$.extend(true,{},this.defaultOptions,opts);this.item=null;this.itemIndex=!!index?index:0;this.initItem();return this};$.extend(true,$.MTHCrmComboBox.Item.prototype,{defaultOptions:{fields:[],textField:"",valueField:"",outCls:"combox-item-normal",overCls:"combox-item-selected",selectedCls:"combox-item-selected",itemData:{},callback:{},displayTpl:"",ctrlID:"",itemFocus:function(item){}},expr_if:/\[if\(([^\)]*)\)=\(([^\)]*)\)\(([^\)]*)\)\:\(([^\)]*)\)\]/g,expr_odd_even:/(?:\[(odd)|\[(even))\:\(([^\)]*)\)\]/g,expr_index:/\[index\]/g,initItem:function(){var self=this;var regFields=[];for(var i=this.options.fields.length-1;i>=0;i--){regFields[i]=new RegExp("{"+this.options.fields[i]+"}","g")}var tarTpl=this.options.displayTpl;var itemData=this.options.itemData;for(var j=regFields.length-1;j>=0;j--){tarTpl=tarTpl.replace(regFields[j],function(patt){return itemData[patt.replace(/\{/g,"").replace(/\}/g,"")]})}tarTpl=tarTpl.replace(this.expr_if,function(patt,$1,$2,$3,$4){if($1==$2){return $3}else{return $4}}).replace(this.expr_odd_even,function(patt,$1,$2,$3){if($1=="odd"&&self.itemIndex%2!=0){return $3}if($2=="even"&&self.itemIndex%2==0){return $3}return""}).replace(this.expr_index,function(patt){return self.itemIndex+1});this.item=$(tarTpl);this.item.addClass(this.options.outCls);this.item.hover(function(){$(this).removeClass(self.options.outCls).addClass(self.options.overCls);self.options.itemFocus(self)},function(){$(this).removeClass(self.options.overCls).addClass(self.options.outCls)});this.item.click(function(){if(self.options.ctrlID!==""){$("#"+self.options.ctrlID).val(self.options.itemData[self.options.textField])}self.options.selected.call(self,self.options.itemData)});this.item.bind(this.options.callback);this.item.data("itemData",itemData)},setOptions:function(opts){$.extend(true,this.options,opts);return this},dispose:function(){var prop;if(!this.item){return}this.item.dropToDusbin();for(prop in this){if(this.hasOwnProperty(prop)){if(!!this[prop]&&!!this[prop].dispose){this[prop].dispose()}this[prop]=null;delete this[prop]}}},appendTo:function(tar){this.item.appendTo(tar);return this},css:function(name,extra){return $.css(this.item,name,extra)}});$.MTHCrmRemoteData=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.remoteDataSet={};this.remoteData=[];this.currentIndex=0;this.requestSuccess=false;this.currentReq=null;this.initRemoteData();return this};$.extend(true,$.MTHCrmRemoteData.prototype,{initRemoteData:function(){},defaultOptions:{url:"",reqData:{},root:"root",success:function(record){},error:$.noop,beforeSend:$.noop,type:"post",dataType:"json",cache:true,contentType:"application/x-www-form-urlencoded",processData:true,reqDataType:"json",keyWord:[],fields:[]},getProTag:function(){var tag="",tagName,i,reqData,keyword;reqData=this.options.reqData;keyword=this.options.keyWord;if(!!keyword&&keyword.length===0){for(tagName in reqData){if(reqData.hasOwnProperty(tagName)){if(tagName==="dummy"){continue}tag+=tagName+reqData[tagName]}}}else{for(i=keyword.length-1;i>=0;i--){if(keyword[i]==="dummy"){continue}tag+=keyword[i]+reqData[keyword[i]]}}return tag},setRequestParam:function(data,type){$.extend(true,this.options.reqData,data)},getData:function(pageIndex){return this.remoteData[pageIndex-1]},request:function(data,callback,act){var isSend=this.options.beforeSend.call(this);if(!!this.currentReq){if(this.currentReq.status!==200){return false}else{this.currentReq=null}}this.requestSuccess=false;this.setRequestParam(data);act=!!act?act:"";if(!!this.remoteDataSet[this.getProTag()]&&act.toLowerCase()!=="refresh"){this.remoteData=this.remoteDataSet[this.getProTag()];this.requestSuccess=true;callback();return}if(act.toLowerCase()==="refresh"){this.setRequestParam({dummy:Math.random()})}var self=this;this.currentReq=$.ajax({url:this.options.url,type:this.options.type,dataType:this.options.dataType,contentType:this.options.contentType,success:function(record){setTimeout(function(){if(self.options.reqDataType!=="json"){record=$.parseJSON(record.d)}if(record.success===false){self.options.success.call(self,record);self.remoteData=record;callback();return}self.remoteDataSet[self.getProTag()]=self.remoteData=record;self.requestSuccess=true;self.options.success.call(self,record);self.currentReq=null;callback()},50)},error:function(a,b,c){self.options.error.call(self,a,b,c);self.remoteData={success:false,errorText:"出现错误，请重试!"};self.currentReq=null;callback()},beforeSend:function(){return isSend},data:this.options.reqDataType=="json"?this.options.reqData:$.toJsonString(this.options.reqData),cache:this.options.cache,processData:this.options.processData})},dispose:function(){for(var prop in this){if(this.hasOwnProperty(prop)){if(!!this[prop]&&!!this[prop].dispose){this[prop].dispose()}this[prop]=null;delete this[prop]}}},clearData:function(){this.remoteDataSet={};this.remoteData=[];this.currentIndex=0;return this}});$.MTHCRMKeyboardNavi=$.fn.MTHCRMKeyboardNavi=function(expr,opts,hlCls,callback,onstart){var defaults={};callback=callback==null?$.noop:callback;onstart=onstart==null?$.noop:onstart;return this.each(function(){var caches={};var self=$(this);var list=self.find(expr);var settings=$.extend(true,defaults,opts);var hl=$("<div></div>").addClass(hlCls);self.prepend(hl);list.click(function(event){onstart.call(self,$(this));$.MTHCRMKeyboardNavi.focus.call(this,hl,self,callback);$.MTHCRMKeyboardNavi.listIndex=$.inArray(this,list)});$("body").keyup(function(event){$.MTHCRMKeyboardNavi.move.call(self,event,hl,list,callback,onstart);event.stopPropagation();return false})})};$.extend(true,$.MTHCRMKeyboardNavi,{move:function(event,hl,list,callback,onstart){var tar,pos,doIt,zIndex;if(event.keyCode==37||event.keyCode==38){if($.MTHCRMKeyboardNavi.listIndex>0){tar=$(list[--$.MTHCRMKeyboardNavi.listIndex]);pos=tar.position();onstart.call(this,tar);zIndex=tar.css("z-index");zIndex=parseInt(zIndex)-1;hl.css({zIndex:zIndex});hl.animate({top:pos.top+"px",left:pos.left+"px",height:tar.height()+"px",width:tar.width()},"fast",function(){callback.call(this,tar)})}}else{if(event.keyCode==39||event.keyCode==40){if($.MTHCRMKeyboardNavi.listIndex<list.length-1){tar=$(list[++$.MTHCRMKeyboardNavi.listIndex]);pos=tar.position();onstart.call(this,tar);zIndex=tar.css("z-index");zIndex=parseInt(zIndex)-1;hl.css({zIndex:zIndex});hl.animate({top:pos.top+"px",left:pos.left+"px",height:tar.height()+"px",width:tar.width()},"fast",function(){callback.call(this,tar)})}}}return false},focus:function(hl,self,callback){var tar=$(this);var pos=tar.position();hl.animate({top:pos.top+"px",left:pos.left+"px",height:(tar.height()+15)+"px",width:tar.width()+"px"},"fast",function(){callback.call(self,tar)})},listIndex:-1});$.MTHCrmTemplate=function(fields,tpl){var regFields="";for(var i=fields.length-1;i>=0;i--){regFields+="{"+fields[i]+"}|"}regFields=new RegExp(regFields.substring(0,regFields.length-1),"gm");return tpl.replace(regFields,function(patt){return self.options.itemData[patt.replace(/\{|\}/mg,"")]})};$.MTHCrmGridView=function(opts){$.MTHCrmComboBox.call(this,opts);return this};$.extend(true,$.MTHCrmGridView.prototype,$.MTHCrmComboBox.prototype,{init:function(){this.mainBody=$(this.options.mainBodyTpl);this.mainBody.bind(this.options.callback);return this},className:"[object MTHCrmGridView]",toString:function(){return this.className},appendTo:function(tar){this.mainBody.appendTo(tar);this.renderComponent();if(this.options.synData){this.getData()}return this},hide:function(){return this},resize:function(){this.mainBody.height("auto");this.itemsShell.height("auto");var tbH=0;if(this.options.paging&&!this.options.pagingBarDelay){tbH=this.pagingBar.height()}var cbH=this.mainBody.height();if(isNaN(cbH)||isNaN(tbH)){this.itemsShell.height("60px");return this}cbH+=tbH;this.itemsShell.css({overflow:"hidden",position:"relative"});if(this.options.maxHeight>0){if(cbH>=this.options.maxHeight){cbH=this.options.maxHeight;if(this.options.allowScroll){this.itemsShell.css({overflowY:"scroll",overflowX:"hidden"})}}else{this.itemsShell.css({overflowY:"hidden"})}}if(this.options.minHeight>0){if(cbH<=this.options.minHeight){cbH=this.options.minHeight}}this.itemsShell.height(cbH-tbH);this.mainBody.height(cbH);return this}});$.MTHCRMAjax=function(opts){this.options=$.extend(true,{},this.defaultOptions,opts);this.currentIndex=0;this.pageCount=0;this.totalCount=0;this.mainBody=$(this.options.mainBodyTpl);this.loadingImg=null;this.reqParams={};this.init()};$.extend(true,$.MTHCRMAjax.prototype,{defaultOptions:{url:"",dataType:"json",type:"get",cache:true,dataShowType:"prepend",mainBodyTpl:"<div></div>",success:$.noop,error:$.noop,pageSize:10,loadingText:"请稍候...",loadingSrc:"../Include/Scripts/MTHCRMWidget/MTHCRMWidgetRes/Images/loading.gif",dataRoot:"data",totalField:"totalCount",pageCountField:"pageCount",callbacks:{},handlerMethod:"",needLoading:true},init:function(){var callbacks=this.options.callbacks,l=callbacks.length,i,selector,handlers,name;for(i=l-1;i>=0;i--){selector=callbacks[i].selector;handlers=callbacks[i].handlers;for(name in handlers){if(handlers.hasOwnProperty(name)){this.mainBody.delegate(selector,name,handlers[name])}}}return this},setReqParams:function(opts){if(this.options.handlerMethod!==""){this.reqParams.method=this.options.handlerMethod}this.reqParams.start=this.currentIndex;this.reqParams.limit=this.options.pageSize;$.extend(true,this.reqParams,opts);return this},getData:function(index){if(index<=this.pageCount||(this.pageCount===0&&this.currentIndex===0)){index=index>0?index:1;var self=this;if(this.options.needLoading){this.loading()}this.currentIndex=index;this.setReqParams();$.ajax({url:this.options.url,dataType:this.options.dataType,data:this.reqParams,type:this.options.type,cache:this.options.cache,success:function(msg){setTimeout(function(){self.totalCount=msg[self.options.totalField];if(self.options.needLoading){self.loadingImg.remove()}self.pageCount=msg[self.options.pageCountField];if(self.pageCount===0){self.currentIndex=0}switch(self.options.dataShowType){case"prepend":self.mainBody.html(msg[self.options.dataRoot].toString()+self.mainBody.html());break;case"append":self.mainBody.html(self.mainBody.html()+msg[self.options.dataRoot].toString());break;case"erase":self.mainBody.html(msg[self.options.dataRoot].toString());break}self.trigger("success");self.options.success.call(self,msg)},15)},error:function(a,b,c){self.trigger("error");self.options.error.call(self,a,b,c)},complete:function(){self.trigger("success")}})}return this},getPrevData:function(){return this.getData(this.currentIndex-1)},getNextData:function(){return this.getData(this.currentIndex+1)},refresh:function(index){this.getData(index)},clearContent:function(){this.mainBody.html("");return this},loading:function(){if(this.loadingImg==null){this.loadingImg=$("<img />");if(parseFloat($.fn.jquery.slice(0,3))<1.6){this.loadingImg.attr({src:this.options.loadingSrc,alt:this.options.loadingText,title:this.options.loadingText})}else{this.loadingImg.prop({src:this.options.loadingSrc,alt:this.options.loadingText,title:this.options.loadingText})}}switch(this.options.dataShowType){case"prepend":this.loadingImg.prependTo(this.mainBody);break;case"append":this.loadingImg.appendTo(this.mainBody);break;case"erase":this.mainBody.find("*").dropToDustbin();this.loadingImg.appendTo(this.mainBody);break}return this},appendTo:function(tar){this.mainBody.appendTo(tar);return this},css:function(name,extra){if(!!extra){return this.mainBody.css(name,extra)}else{return this.mainBody.css(name)}},trigger:function(evt,handler,params){var paramArr;if(!handler){paramArr=[this];if(!!params){$.merge(paramArr,params)}this.mainBody.trigger(evt,paramArr)}else{this.mainBody.bind(evt,handler)}return this}});StringBuilder=function(){this.builder=[]};StringBuilder.prototype={append:function(){var i,l=arguments.length;for(i=0;i<l;i++){this.builder.push(arguments[i])}return this},toString:function(){return this.builder.join("")}};NameSpace=function(ns,p){var context=!!p?p:window,nameList=ns.split("."),tmpName;while(nameList.length>0&&!context[tmpName=nameList.shift()]){context[tmpName]={};context=context[tmpName]}}})(jQuery);